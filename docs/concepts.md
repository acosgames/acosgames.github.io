# Dev Concepts

Overview of the concepts that make games work on the Acos platform.

## Projects

### Game Client

The client is responsible for displaying the game state that is forwarded to your game's front end. There is a helper file called [acosg.js](https://github.com/acosgames/tictactoe/blob/main/game-client/acosg.js)that listens for incoming state updates. Everytime there is an update, you will receive the full state. The TicTacToe example uses ReactJS, but any JS framework can be used, as long as you can receive updates and send actions by re-creating what the [acosg.js](https://github.com/acosgames/tictactoe/blob/main/game-client/acosg.js) file does.

#### Send Action

Client's can send actions in the following format using the acosg.js `send` function:

```js
send("pick", 3);
```

The first parameter is always a string, second parameter can be any primitive, array, or object type.

## Game Server

The server is responsible for building the **game state** that is automatically synchronized to all clients.

There is a helper file used on the game-server side also called [acosg.js](https://github.com/acosgames/tictactoe/blob/main/game-server/acosg.js). Its a wrapper to help simplify using the globals listed below.

See the [index.js](https://github.com/acosgames/tictactoe/blob/main/game-server/index.js) and [game.js](https://github.com/acosgames/tictactoe/blob/main/game-server/game.js) for the usage of the helper file.

Your server code will be run inside a JS virtual machine, and you will have access to the **globals** object.

```js
//log a message, only available in simulator
globals.log(msg);

//log an error, only available in simulator
globals.error(msg);

//get the array of actions sent by users or system
globals.actions();

//get the last gameState object, copy this to a variable and make changes directly to it
globals.game();

//get the database JSON
globals.database();

//when finished updating, call this to "commit" the state
globals.finish(gameState);

//kill the game immediately
globals.killGame();

//if you detect a bad action, tell system you want it ignored.
globals.ignore();
```

## Game State Objects

The Game State consists of several objects:

```json
{
  "state": {},
  "players": {},
  "rules": {},
  "events": {},
  "timer": {},
  "next": {}
}
```

### state

This is where you should keep all data that mutates on every action that affects the game board or environment.

#### hidden values

Inside the `state` object, you can create variables with `_` underscore to make them private.

Example, that hides the deck from sending to clients:

```json
{
  "state": {
    "_deck": ["AS", "AH", "3D"]
  }
}
```

#### gamestatus

The **gamestatus** key is auto-generated by the platform and saved inside the `state`.

The possible values are:

1. `pregame`
2. `starting`
3. `gamestart`
4. `gameover`

Example:

```json
{
  "state": {
    "gamestatus": "gamestart"
  }
}
```

Game status is used internally by the platform with the timer to trigger the next gamestatus. Exception is when `gamestatus="gamestart"`, the timers will cause a "skip" action, for the current player(s) who are next.

### players

When players are added into the game, they are automatically added into the players object. All players have a `shortid` that references them inside the Acos databse.

```json
{
  "players": {
    "ABCDEF": {
      "name": "JoeFacebook",
      "rank": 2,
      "score": 0,
      "ready": true
    },
    "UVWXYZ": {
      "name": "JoeOfTexas",
      "rank": 2,
      "score": 0,
      "ready": true
    }
  }
}
```

#### ready

Your client must trigger an action `send('ready', true)` when your client front-end is loaded. This is saved into the player's object, and let's the platform know when to trigger a **gamestart** event.

#### rank & score

`rank` is set by you to determine who is in 1st, 2nd, 3rd, ..., nth place. On gameover, the system will update the player ratings based on this value.

`score` is set by your to determine how many points the users have earned. This has no purpose, unless rank is removed, scores are used to calculate new player ratings.

#### name

`name` is the user's name that was setup when user first logged in.

#### hidden values

Inside the `players` object, you can create variables with `_` underscore to make them private.

Example that hides the user's cards from sharing with other players:

```json
{
  "player": {
    "ABCDEF": {
      "name": "JoeOfTexas",
      "rank": 1,
      "_cards": ["2S", "3S", "4S", "5S", "6S"]
    }
  }
}
```

### rules

Rules are not mandatory, but its a clean way to define the rules of your game. How many rounds, max players, min players. Ideally, these should be static and not change, but you can change between actions if needed.

```json
{
  "rules": {
    "maxplayers": 2,
    "minplayers": 2,
    "rounds": 3
  }
}
```

### events

Events are used to notify when an actions occur from a user or the Acos platform

- **pregame**
  - Triggered when the first player joins the game
- **starting**
  - Triggered when all players are ready (client front-ends are all loaded)
- **gamestart**
  - Triggered after the starting countdown reaches zero
- **gameover**
  - Triggered when the game ends and room is closed

**custom events**

You can create your own events by defining any key, here we used `pick`:

```json
{
  "events": {
    "pick": {
      "user": "ABCDEF",
      "picked": 3
    }
  }
}
```

Or you could do even simpler:

```json
{
  "events": {
    "pick": 3
  }
}
```

### timer

The timer helps control the flow of the game. It is important that you always set a timer. Rooms will be destroyed if they do not complete within 1 hour.

To set a timer, make sure you commit the game state with this format:

```json
{
  "timer": {
    "set": 15
  }
}
```

The example above sets a timer for 15 seconds.

The platform will detect the seconds set, and create these values:

```json
{
  "timer": {
    "end": 1641166075,
    "seconds": 15
  }
}
```

On the client-side, `end` can be used to calculate timeleft.

### next

The next object is used to tell the system who is allowed to send an action.

```json
{
  "next": {
    "id": "*"
  }
}
```

The only required key is the `id` key. The values can be either `*` or player's shortid, i.e. `ABCDEF`
